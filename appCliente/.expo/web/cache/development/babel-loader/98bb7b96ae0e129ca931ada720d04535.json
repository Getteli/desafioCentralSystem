{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/var/www/html/Desafio/appCliente/pages/LinkExpo.js\";\nimport React, { useEffect, useState } from 'react';\nimport Button from \"react-native-web/dist/exports/Button\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { useNavigation } from '@react-navigation/native';\nimport * as AppAuth from 'expo-app-auth';\nexport default function LinkExpo() {\n  var navigation = useNavigation();\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      authState = _useState2[0],\n      setAuthState = _useState2[1];\n\n  useEffect(function () {\n    (function _callee() {\n      var cachedAuth;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(getCachedAuthAsync());\n\n            case 2:\n              cachedAuth = _context.sent;\n\n              if (cachedAuth && !authState) {\n                setAuthState(cachedAuth);\n              }\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n  }, []);\n  return React.createElement(View, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24,\n      columnNumber: 5\n    }\n  }, React.createElement(Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 7\n    }\n  }, \"Expo AppAuth Example\"), React.createElement(Button, {\n    title: \"Logar com a API\",\n    onPress: function _callee2() {\n      var _authState;\n\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(signInAsync());\n\n            case 2:\n              _authState = _context2.sent;\n              setAuthState(_authState);\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 7\n    }\n  }), React.createElement(Button, {\n    title: \"Deslogar - nao fiz ainda \",\n    onPress: function _callee3() {\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(signOutAsync(authState));\n\n            case 2:\n              setAuthState(null);\n\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 33,\n      columnNumber: 7\n    }\n  }), React.createElement(Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 7\n    }\n  }, JSON.stringify(authState, null, 2)), React.createElement(TouchableOpacity, {\n    onPress: function onPress() {\n      return navigation.goBack();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 7\n    }\n  }, React.createElement(Text, {\n    style: styles.textButton,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 9\n    }\n  }, \"Voltar\")));\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center'\n  }\n});\nvar config = {\n  issuer: 'http://192.168.1.40:3030/oauth/authorize?',\n  scopes: [''],\n  clientId: '3'\n};\nvar StorageKey = '@MyApp:CustomGoogleOAuthKey';\nexport function signInAsync() {\n  var authState;\n  return _regeneratorRuntime.async(function signInAsync$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return _regeneratorRuntime.awrap(AppAuth.authAsync(config));\n\n        case 2:\n          authState = _context4.sent;\n          _context4.next = 5;\n          return _regeneratorRuntime.awrap(cacheAuthAsync(authState));\n\n        case 5:\n          console.log('signInAsync', authState);\n          return _context4.abrupt(\"return\", authState);\n\n        case 7:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction cacheAuthAsync(authState) {\n  return _regeneratorRuntime.async(function cacheAuthAsync$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return _regeneratorRuntime.awrap(AsyncStorage.setItem(StorageKey, JSON.stringify(authState)));\n\n        case 2:\n          return _context5.abrupt(\"return\", _context5.sent);\n\n        case 3:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nexport function getCachedAuthAsync() {\n  var value, authState;\n  return _regeneratorRuntime.async(function getCachedAuthAsync$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return _regeneratorRuntime.awrap(AsyncStorage.getItem(StorageKey));\n\n        case 2:\n          value = _context6.sent;\n          authState = JSON.parse(value);\n          console.log('getCachedAuthAsync', authState);\n\n          if (!authState) {\n            _context6.next = 11;\n            break;\n          }\n\n          if (!checkIfTokenExpired(authState)) {\n            _context6.next = 10;\n            break;\n          }\n\n          return _context6.abrupt(\"return\", refreshAuthAsync(authState));\n\n        case 10:\n          return _context6.abrupt(\"return\", authState);\n\n        case 11:\n          return _context6.abrupt(\"return\", null);\n\n        case 12:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction checkIfTokenExpired(_ref) {\n  var accessTokenExpirationDate = _ref.accessTokenExpirationDate;\n  return new Date(accessTokenExpirationDate) < new Date();\n}\n\nfunction refreshAuthAsync(_ref2) {\n  var refreshToken, authState;\n  return _regeneratorRuntime.async(function refreshAuthAsync$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          refreshToken = _ref2.refreshToken;\n          _context7.next = 3;\n          return _regeneratorRuntime.awrap(AppAuth.refreshAsync(config, refreshToken));\n\n        case 3:\n          authState = _context7.sent;\n          console.log('refreshAuth', authState);\n          _context7.next = 7;\n          return _regeneratorRuntime.awrap(cacheAuthAsync(authState));\n\n        case 7:\n          return _context7.abrupt(\"return\", authState);\n\n        case 8:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nexport function signOutAsync(_ref3) {\n  var accessToken;\n  return _regeneratorRuntime.async(function signOutAsync$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          accessToken = _ref3.accessToken;\n          _context8.prev = 1;\n          _context8.next = 4;\n          return _regeneratorRuntime.awrap(AppAuth.revokeAsync(config, {\n            token: accessToken,\n            isClientIdProvided: true\n          }));\n\n        case 4:\n          _context8.next = 6;\n          return _regeneratorRuntime.awrap(AsyncStorage.removeItem(StorageKey));\n\n        case 6:\n          return _context8.abrupt(\"return\", null);\n\n        case 9:\n          _context8.prev = 9;\n          _context8.t0 = _context8[\"catch\"](1);\n          alert(\"Failed to revoke token: \" + _context8.t0.message);\n\n        case 12:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, null, null, [[1, 9]], Promise);\n}","map":{"version":3,"sources":["/var/www/html/Desafio/appCliente/pages/LinkExpo.js"],"names":["React","useEffect","useState","AsyncStorage","useNavigation","AppAuth","LinkExpo","navigation","authState","setAuthState","getCachedAuthAsync","cachedAuth","styles","container","signInAsync","_authState","signOutAsync","JSON","stringify","goBack","textButton","StyleSheet","create","flex","backgroundColor","alignItems","justifyContent","config","issuer","scopes","clientId","StorageKey","authAsync","cacheAuthAsync","console","log","setItem","getItem","value","parse","checkIfTokenExpired","refreshAuthAsync","accessTokenExpirationDate","Date","refreshToken","refreshAsync","accessToken","revokeAsync","token","isClientIdProvided","removeItem","alert","message"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;;;;;;AAEA,OAAOC,YAAP,MAAyB,2CAAzB;AACA,SAASC,aAAT,QAA8B,0BAA9B;AACA,OAAO,KAAKC,OAAZ,MAAyB,eAAzB;AAEA,eAAe,SAASC,QAAT,GAAoB;AAGjC,MAAMC,UAAU,GAAGH,aAAa,EAAhC;;AAHiC,kBAKDF,QAAQ,CAAC,IAAD,CALP;AAAA;AAAA,MAK5BM,SAL4B;AAAA,MAKjBC,YALiB;;AAOjCR,EAAAA,SAAS,CAAC,YAAM;AACd,KAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACwBS,kBAAkB,EAD1C;;AAAA;AACKC,cAAAA,UADL;;AAEC,kBAAIA,UAAU,IAAI,CAACH,SAAnB,EAA8B;AAC5BC,gBAAAA,YAAY,CAACE,UAAD,CAAZ;AACD;;AAJF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAD;AAMD,GAPQ,EAON,EAPM,CAAT;AASA,SACE,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAEC,MAAM,CAACC,SAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BADF,EAEE,oBAAC,MAAD;AACE,IAAA,KAAK,EAAC,iBADR;AAEE,IAAA,OAAO,EAAE;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACkBC,WAAW,EAD7B;;AAAA;AACDC,cAAAA,UADC;AAEPN,cAAAA,YAAY,CAACM,UAAD,CAAZ;;AAFO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAFX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,EASE,oBAAC,MAAD;AACE,IAAA,KAAK,EAAC,2BADR;AAEE,IAAA,OAAO,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACDC,YAAY,CAACR,SAAD,CADX;;AAAA;AAEPC,cAAAA,YAAY,CAAC,IAAD,CAAZ;;AAFO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAFX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IATF,EAgBE,oBAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAOQ,IAAI,CAACC,SAAL,CAAeV,SAAf,EAA0B,IAA1B,EAAgC,CAAhC,CAAP,CAhBF,EAkBE,oBAAC,gBAAD;AAAkB,IAAA,OAAO,EAAE;AAAA,aAAMD,UAAU,CAACY,MAAX,EAAN;AAAA,KAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAEP,MAAM,CAACQ,UAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,CAlBF,CADF;AAyBD;AAED,IAAMR,MAAM,GAAGS,UAAU,CAACC,MAAX,CAAkB;AAC/BT,EAAAA,SAAS,EAAE;AACTU,IAAAA,IAAI,EAAE,CADG;AAETC,IAAAA,eAAe,EAAE,MAFR;AAGTC,IAAAA,UAAU,EAAE,QAHH;AAITC,IAAAA,cAAc,EAAE;AAJP;AADoB,CAAlB,CAAf;AASA,IAAIC,MAAM,GAAG;AACXC,EAAAA,MAAM,EAAE,2CADG;AAEXC,EAAAA,MAAM,EAAE,CAAC,EAAD,CAFG;AAGXC,EAAAA,QAAQ,EAAE;AAHC,CAAb;AAMA,IAAIC,UAAU,GAAG,6BAAjB;AAEA,OAAO,SAAejB,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CACiBT,OAAO,CAAC2B,SAAR,CAAkBL,MAAlB,CADjB;;AAAA;AACDnB,UAAAA,SADC;AAAA;AAAA,2CAECyB,cAAc,CAACzB,SAAD,CAFf;;AAAA;AAGL0B,UAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2B3B,SAA3B;AAHK,4CAIEA,SAJF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAOP,SAAeyB,cAAf,CAA8BzB,SAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CACeL,YAAY,CAACiC,OAAb,CAAqBL,UAArB,EAAiCd,IAAI,CAACC,SAAL,CAAeV,SAAf,CAAjC,CADf;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAIA,OAAO,SAAeE,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CACaP,YAAY,CAACkC,OAAb,CAAqBN,UAArB,CADb;;AAAA;AACDO,UAAAA,KADC;AAED9B,UAAAA,SAFC,GAEWS,IAAI,CAACsB,KAAL,CAAWD,KAAX,CAFX;AAGLJ,UAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkC3B,SAAlC;;AAHK,eAIDA,SAJC;AAAA;AAAA;AAAA;;AAAA,eAKCgC,mBAAmB,CAAChC,SAAD,CALpB;AAAA;AAAA;AAAA;;AAAA,4CAMMiC,gBAAgB,CAACjC,SAAD,CANtB;;AAAA;AAAA,4CAQMA,SARN;;AAAA;AAAA,4CAWE,IAXF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAcP,SAASgC,mBAAT,OAA4D;AAAA,MAA7BE,yBAA6B,QAA7BA,yBAA6B;AAC1D,SAAO,IAAIC,IAAJ,CAASD,yBAAT,IAAsC,IAAIC,IAAJ,EAA7C;AACD;;AAED,SAAeF,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkCG,UAAAA,YAAlC,SAAkCA,YAAlC;AAAA;AAAA,2CACwBvC,OAAO,CAACwC,YAAR,CAAqBlB,MAArB,EAA6BiB,YAA7B,CADxB;;AAAA;AACMpC,UAAAA,SADN;AAEE0B,UAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2B3B,SAA3B;AAFF;AAAA,2CAGQyB,cAAc,CAACzB,SAAD,CAHtB;;AAAA;AAAA,4CAISA,SAJT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAOA,OAAO,SAAeQ,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8B8B,UAAAA,WAA9B,SAA8BA,WAA9B;AAAA;AAAA;AAAA,2CAEGzC,OAAO,CAAC0C,WAAR,CAAoBpB,MAApB,EAA4B;AAChCqB,YAAAA,KAAK,EAAEF,WADyB;AAEhCG,YAAAA,kBAAkB,EAAE;AAFY,WAA5B,CAFH;;AAAA;AAAA;AAAA,2CAMG9C,YAAY,CAAC+C,UAAb,CAAwBnB,UAAxB,CANH;;AAAA;AAAA,4CAOI,IAPJ;;AAAA;AAAA;AAAA;AASHoB,UAAAA,KAAK,8BAA4B,aAAEC,OAA9B,CAAL;;AATG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Button, StyleSheet, Text, View, TouchableOpacity } from 'react-native';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { useNavigation } from '@react-navigation/native';\nimport * as AppAuth from 'expo-app-auth';\n\nexport default function LinkExpo() {\n\n  // button\n  const navigation = useNavigation();\n\n  let [authState, setAuthState] = useState(null);\n\n  useEffect(() => {\n    (async () => {\n      let cachedAuth = await getCachedAuthAsync();\n      if (cachedAuth && !authState) {\n        setAuthState(cachedAuth);\n      }\n    })();\n  }, []);\n\n  return (\n    <View style={styles.container}>\n      <Text>Expo AppAuth Example</Text>\n      <Button\n        title=\"Logar com a API\"\n        onPress={async () => {\n          const _authState = await signInAsync();\n          setAuthState(_authState);\n        }}\n      />\n      <Button\n        title=\"Deslogar - nao fiz ainda \"\n        onPress={async () => {\n          await signOutAsync(authState);\n          setAuthState(null);\n        }}\n      />\n      <Text>{JSON.stringify(authState, null, 2)}</Text>\n\n      <TouchableOpacity onPress={() => navigation.goBack()}>\n        <Text style={styles.textButton}>Voltar</Text>\n      </TouchableOpacity>\n\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n});\n\nlet config = {\n  issuer: 'http://192.168.1.40:3030/oauth/authorize?',\n  scopes: [''],\n  clientId: '3',\n};\n\nlet StorageKey = '@MyApp:CustomGoogleOAuthKey';\n\nexport async function signInAsync() {\n  let authState = await AppAuth.authAsync(config);\n  await cacheAuthAsync(authState);\n  console.log('signInAsync', authState);\n  return authState;\n}\n\nasync function cacheAuthAsync(authState) {\n  return await AsyncStorage.setItem(StorageKey, JSON.stringify(authState));\n}\n\nexport async function getCachedAuthAsync() {\n  let value = await AsyncStorage.getItem(StorageKey);\n  let authState = JSON.parse(value);\n  console.log('getCachedAuthAsync', authState);\n  if (authState) {\n    if (checkIfTokenExpired(authState)) {\n      return refreshAuthAsync(authState);\n    } else {\n      return authState;\n    }\n  }\n  return null;\n}\n\nfunction checkIfTokenExpired({ accessTokenExpirationDate }) {\n  return new Date(accessTokenExpirationDate) < new Date();\n}\n\nasync function refreshAuthAsync({ refreshToken }) {\n  let authState = await AppAuth.refreshAsync(config, refreshToken);\n  console.log('refreshAuth', authState);\n  await cacheAuthAsync(authState);\n  return authState;\n}\n\nexport async function signOutAsync({ accessToken }) {\n  try {\n    await AppAuth.revokeAsync(config, {\n      token: accessToken,\n      isClientIdProvided: true,\n    });\n    await AsyncStorage.removeItem(StorageKey);\n    return null;\n  } catch (e) {\n    alert(`Failed to revoke token: ${e.message}`);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}